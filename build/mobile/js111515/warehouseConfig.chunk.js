(this.webpackJsonpfannix=this.webpackJsonpfannix||[]).push([[127],{1066:function(e,t,n){},1878:function(e,t,n){},936:function(e,t,n){"use strict";n.r(t),n.d(t,"reducer",(function(){return J})),n.d(t,"view",(function(){return T}));var a,i,r,c,o,s,u,l=n(7),d=n(8),f=n(9),m=n(10),h=n(0),p=n.n(h),E=n(1),g=n(11),O=n(6),y=(n(32),n(61),n(62),n(83),n(76),n(47)),b=(n(1878),n(1066),n(24)),C=n(12),v=n(78),S=n(2),w=n(14),A=function(){return function(e){Object(v.a)("getWarehouseTree","POST",JSON.stringify({uuidList:[]}),(function(t){Object(C.u)(t,"","","",!0)&&e({type:"GET_WAREHOUSE_TREE",data:t.data.cardList})}))}},L=function(e,t){return{type:"CHANGE_WAREHOUSE_DATA",dataType:e,value:t}},j=function(e){return{type:"CHECKED_WAREHOUSE_CARD",uuid:e}},k=function(e){return{type:"ADD_WAREHOUSE_CARD",parentCard:e}},R=function(e,t){return function(n,a){var i=a().warehouseState,r=i.getIn(["data","name"]),c=i.getIn(["data","uuid"]);S.a.toast.loading(w.p,0),Object(v.a)("warehouseCardNameRepeat","POST",JSON.stringify({name:r,uuid:c}),(function(a){S.a.toast.hide(),Object(C.u)(a)&&(a.data.codeList.length?S.a.Confirm({message:"\u5361\u7247\u540d\u79f0\u4e0e[\u7f16\u7801\uff1a".concat(a.data.codeList[0],"]\u5361\u7247\u91cd\u590d\uff0c\u786e\u5b9a\u4fdd\u5b58\u5417\uff1f"),title:"\u540d\u79f0\u91cd\u590d",buttonLabels:["\u53d6\u6d88","\u786e\u5b9a"],onSuccess:function(a){1===a.buttonIndex&&n(D(e,t))},onFail:function(e){return alert(e)}}):n(D(e,t)))}))}},D=function(e,t){return function(n,a){var i=a().warehouseState,r=i.get("data").toJS(),c="insert"==i.getIn(["views","insertOrModify"]);c&&(r.action="MANAGER-WAREHOUSE_SETTING-CUD_CARD"),S.a.toast.loading(w.p,0),Object(v.a)("".concat(c?"insertWarehouseCard":"modifyWarehouseCard"),"POST",JSON.stringify(r),(function(a){S.a.toast.hide(),Object(C.u)(a,"show")&&(n(A()),t?(n(L(["data","name"],"")),n(L(["data","code"],"")),n(L(["data","uuid"],""))):e.goBack())}))}},I=Object(b.immutableRenderDecorator)((r=i=function(e){Object(m.a)(n,e);var t=Object(f.a)(n);function n(){return Object(l.a)(this,n),t.apply(this,arguments)}return Object(d.a)(n,[{key:"render",value:function(){var e=this.props,t=e.hasSub,n=e.isExpanded,a=e.item,i=e.isAdd,r=e.isDelete,c=e.dispatch,o=e.leve,s=e.checked,u=e.history,l={1:function(){return""},2:function(){return p.a.createElement("span",{className:"ac-flag",style:{width:".1rem",backgroundColor:"#D1C0A5"}})},3:function(){return p.a.createElement("span",{className:"ac-flag",style:{width:".2rem",backgroundColor:"#7E6B5A"}})},4:function(){return p.a.createElement("span",{className:"ac-flag",style:{width:".3rem",backgroundColor:"#59493f"}})}}[o](),d=a.get("uuid"),f=a.get("code"),m=a.get("name");return p.a.createElement("div",{className:1==o?"warehouse-item":"warehouse-item warehouse-sub"},p.a.createElement(g.e,{className:"",style:{display:r?"":"none"},checked:s,onClick:function(){c(j(d))}}),p.a.createElement(g.l,{style:{display:i?"":"none",color:"#5d81d1",marginRight:".05rem",visibility:o>3?"hidden":""},type:"add-plus-fill",size:"18",onClick:function(){c(k({uuid:d,code:f,name:m})),u.push("/config/warehouse/card")}}),l,p.a.createElement("div",{className:"warehouse-item-name"},p.a.createElement("span",{onClick:function(){i?(c(k({uuid:d,code:f,name:m})),u.push("/config/warehouse/card")):c(r?j(d):function(e,t){return function(n){S.a.toast.loading(w.p,0),Object(v.a)("getWarehouseSingleCard","GET","uuid=".concat(e),(function(e){S.a.toast.hide(),Object(C.u)(e)&&(n({type:"GET_WAREHOUSE_SINGLE_CARD",data:e.data}),t.push("/config/warehouse/card"))}))}}(d,u))}}," ".concat(f," ").concat(m))),p.a.createElement("div",{onClick:function(){c(function(e){return{type:"WAREHOUSE_TOGGLELOWER",uuid:e}}(d))}},p.a.createElement(g.l,{type:"arrow-down",style:{display:t?"":"none",transform:n?"rotate(180deg)":""}})))}}]),n}(p.a.Component),i.displayName="WarehouseItem",a=r))||a,_=Object(y.c)((function(e){return e}))(c=function(e){Object(m.a)(n,e);var t=Object(f.a)(n);function n(){var e;Object(l.a)(this,n);for(var a=arguments.length,i=new Array(a),r=0;r<a;r++)i[r]=arguments[r];return(e=t.call.apply(t,[this].concat(i))).state={isDelete:!1},e}return Object(d.a)(n,[{key:"componentDidMount",value:function(){S.a.setTitle({title:"\u4ed3\u5e93\u8bbe\u7f6e"}),S.a.setIcon({showIcon:!1}),S.a.setRight({show:!1});var e=this.props.dispatch;"home"===sessionStorage.getItem("prevPage")&&(sessionStorage.removeItem("prevPage"),e(A()))}},{key:"render",value:function(){var e=this,t=this.props,n=t.dispatch,a=t.warehouseState,i=t.history,r=t.homeState,c=this.state.isDelete,o=r.getIn(["permissionInfo","Config"]).getIn(["edit","permission"]),s=a.get("treeList"),u=a.get("showChildList"),l=a.get("deleteList").toJS(),d=a.getIn(["views","isAdd"]);return p.a.createElement(g.h,{className:"warehouse-config border-top"},p.a.createElement("div",{style:{display:!!d&&""},className:"warehouse-add",onClick:function(){n(k({uuid:"",code:"ALLCRD",name:"\u65e0"})),i.push("/config/warehouse/card")}},p.a.createElement(g.l,{type:"add",color:"#7E6B5B",size:"14"}),"\u6dfb\u52a0\u4e00\u7ea7\u4ed3\u5e93"),p.a.createElement(g.s,{flex:"1"},function e(t,a){var r=[];return t&&t.forEach((function(t,o){var s=l.includes(t.get("uuid")),f=u.includes(t.get("uuid")),m=t.get("childList").size,h=t.get("disableList").size,E="ALLCRD"==t.get("code");m||h?r.push(p.a.createElement("div",{key:t.get("uuid")},E?null:p.a.createElement(I,{leve:a,hasSub:!0,isExpanded:f,item:t,isAdd:d,isDelete:c,dispatch:n,checked:s,history:i}),(f||E)&&m?e(t.get("childList"),a+1):"",(f||E)&&h?e(t.get("disableList"),a+1):"")):E||r.push(p.a.createElement(I,{leve:a,hasSub:!1,key:t.get("uuid"),item:t,isAdd:d,isDelete:c,dispatch:n,checked:s,history:i}))})),r}(s,0)),p.a.createElement(g.d,{disabled:!o,style:{display:c||d?"none":""}},p.a.createElement(g.c,{disabled:!o,onClick:function(){return n(L(["views","isAdd"],!0))}},p.a.createElement(g.l,{type:"add-plus"}),p.a.createElement("span",null,"\u65b0\u589e")),p.a.createElement(g.c,{disabled:0==s.size||!o,onClick:function(){return e.setState({isDelete:!0})}},p.a.createElement(g.l,{type:"select",size:"15"}),p.a.createElement("span",null,"\u9009\u62e9"))),p.a.createElement(g.d,{style:{display:c||d?"":"none"}},p.a.createElement(g.c,{onClick:function(){c&&(e.setState({isDelete:!1}),n({type:"CLEAR_WAREHOUSE_CHECKED"})),d&&n(L(["views","isAdd"],!1))}},p.a.createElement(g.l,{type:"cancel"}),p.a.createElement("span",null,"\u53d6\u6d88")),p.a.createElement(g.c,{style:{display:c?"":"none"},disabled:0==l.length||!o,onClick:function(){n(function(e,t){return function(n){S.a.toast.loading(w.p,0),Object(v.a)("deleteWarehouseCard","POST",JSON.stringify({deleteList:e}),(function(e){S.a.toast.hide(),Object(C.u)(e)&&(e.data.errorChild&&S.a.toast.info("".concat(e.data.errorChild,"\u5b58\u5728\u4e0b\u7ea7,\u4e0d\u5141\u8bb8\u5220\u9664")),e.data.errorOpen?S.a.toast.info("".concat(e.data.errorOpen,"\u5df2\u8bbe\u7f6e\u671f\u521d\u503c")):S.a.toast.success("\u5220\u9664\u6210\u529f"),n(A()),t())}))}}(l,(function(){return e.setState({isDelete:!1})})))}},p.a.createElement(g.l,{type:"delete"}),p.a.createElement("span",null,"\u5220\u9664"))))}}]),n}(p.a.Component))||c,N=g.k.Item,W=Object(y.c)((function(e){return e}))((u=s=function(e){Object(m.a)(n,e);var t=Object(f.a)(n);function n(e){var a;return Object(l.a)(this,n),(a=t.call(this,e)).state={},a}return Object(d.a)(n,[{key:"componentDidMount",value:function(){S.a.setTitle({title:"\u4ed3\u5e93\u5361\u7247"}),S.a.setIcon({showIcon:!1}),S.a.setRight({show:!1})}},{key:"render",value:function(){var e=this.props,t=e.dispatch,n=e.warehouseState,a=e.history,i=e.homeState,r=n.getIn(["views","insertOrModify"]),c=n.getIn(["views","fromPage"]),o=n.get("data"),s=o.get("canUse"),u=(n.getIn(["views","insertOrModify"]),n.get("treeList"),i.getIn(["permissionInfo","Config"]).getIn(["edit","permission"]));return p.a.createElement(g.h,{className:"warehouse-config"},p.a.createElement(g.s,{flex:"1",className:"border-top"},p.a.createElement(g.k,null,p.a.createElement(N,{label:"\u4ed3\u5e93\u7f16\u7801",showAsterisk:!0,className:"config-form-item-input-style"},p.a.createElement(g.z,{placeholder:"\u652f\u6301\u6570\u5b57\u548c\u82f1\u6587\u5927\u5c0f\u5199",value:o.get("code"),onChange:function(e){return C.g.inputCheck("code",e,(function(){t(L(["data","code"],e))}))}})),p.a.createElement(N,{label:"\u4ed3\u5e93\u540d\u79f0",showAsterisk:!0,className:"config-form-item-input-style"},p.a.createElement(g.z,{placeholder:"\u586b\u5199\u540d\u79f0",value:o.get("name"),onChange:function(e){t(L(["data","name"],e))}})),p.a.createElement(N,{label:"\u4e0a\u7ea7\u4ed3\u5e93"},"ALLCRD"==o.getIn(["parentCard","code"])?"\u65e0":o.getIn(["parentCard","name"])),p.a.createElement(N,{label:"\u542f\u7528/\u505c\u7528",style:{display:"insert"==r?"none":""}},p.a.createElement("span",{className:"noTextSwitchShort"},p.a.createElement(g.w,{checked:s,onClick:function(){t(L(["data","canUse"],!s))}}))))),p.a.createElement(g.d,null,p.a.createElement(g.c,{onClick:function(){a.goBack()}},p.a.createElement(g.l,{type:"cancel"}),p.a.createElement("span",null,"\u53d6\u6d88")),p.a.createElement(g.c,{disabled:!u,onClick:function(){C.g.beforeSaveCheck([{type:"name",value:o.get("name")},{type:"code",value:o.get("code")}],(function(){t(R(a))}))}},p.a.createElement(g.l,{type:"save"}),p.a.createElement("span",null,"\u4fdd\u5b58")),p.a.createElement(g.c,{disabled:!u,style:{display:"insert"==r&&"otherPage"!==c?"":"none"},onClick:function(){C.g.beforeSaveCheck([{type:"name",value:o.get("name")},{type:"code",value:o.get("code")}],(function(){t(R(a,!0))}))}},p.a.createElement(g.l,{type:"new"}),p.a.createElement("span",null,"\u4fdd\u5b58\u5e76\u65b0\u589e"))))}}]),n}(p.a.Component),s.displayName="WarehouseCard",o=u))||o,T=function(e){Object(m.a)(n,e);var t=Object(f.a)(n);function n(){return Object(l.a)(this,n),t.apply(this,arguments)}return Object(d.a)(n,[{key:"render",value:function(){return p.a.createElement(g.h,{className:"project-config"},p.a.createElement(O.a,{path:"/config/warehouse/index",component:_}),p.a.createElement(O.a,{path:"/config/warehouse/card",component:W}))}}]),n}(p.a.Component),H=(n(55),n(33),n(31),n(4)),U=Object(E.fromJS)({views:{insertOrModify:"insert",isAdd:!1},data:{code:"",name:"",uuid:"",canUse:!0,parentCard:{uuid:"",code:"",name:""}},treeList:[],deleteList:[],showChildList:[]});var J={warehouseState:function(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:U,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return((e={},Object(H.a)(e,"INIT_WAREHOUSE",(function(){return U})),Object(H.a)(e,"GET_WAREHOUSE_TREE",(function(){return t.set("treeList",Object(E.fromJS)(n.data)).set("deleteList",Object(E.fromJS)([]))})),Object(H.a)(e,"CHANGE_WAREHOUSE_DATA",(function(){return t.setIn(n.dataType,n.value)})),Object(H.a)(e,"WAREHOUSE_TOGGLELOWER",(function(){return t.get("showChildList").indexOf(n.uuid)>-1?t.update("showChildList",(function(e){return e.map((function(e){return e.indexOf(n.uuid)>-1?"":e})).filter((function(e){return!!e}))})):t.update("showChildList",(function(e){return e.push(n.uuid)}))})),Object(H.a)(e,"GET_WAREHOUSE_SINGLE_CARD",(function(){return t.set("data",Object(E.fromJS)(n.data)).setIn(["views","insertOrModify"],"modify")})),Object(H.a)(e,"CHECKED_WAREHOUSE_CARD",(function(){var e=t.get("deleteList").toJS(),a=t.get("treeList").toJS(),i=[n.uuid],r=[],c=!1;return function e(t,a){t.map((function(t){a?(i.push(t.uuid),e(t.childList,!0),e(t.disableList,!0)):t.uuid==n.uuid?(c=!0,e(t.childList,!0),e(t.disableList,!0)):(c||r.push(t.uuid),e(t.childList,!1),e(t.disableList,!1)),c||r.pop()}))}(a,!1),e.includes(n.uuid)?(i.forEach((function(t){e=e.filter((function(e){return e!=t}))})),r.forEach((function(t){e=e.filter((function(e){return e!=t}))}))):i.forEach((function(t){e.push(t)})),t.set("deleteList",Object(E.fromJS)(e))})),Object(H.a)(e,"ADD_WAREHOUSE_CARD",(function(){return t.setIn(["views","insertOrModify"],"insert").set("data",Object(E.fromJS)({code:"",name:"",uuid:"",canUse:!0,parentCard:n.parentCard}))})),Object(H.a)(e,"CLEAR_WAREHOUSE_CHECKED",(function(){return t.set("deleteList",Object(E.fromJS)([]))})),e)[n.type]||function(){return t})()}}}}]);
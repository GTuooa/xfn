(window.webpackJsonp=window.webpackJsonp||[]).push([[26],{1053:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.view=t.reducer=void 0;var r=a(n(2641));function a(e){return e&&e.__esModule?e:{default:e}}var o={previewEnclosureState:a(n(186)).default};t.reducer=o,t.view=r.default},2641:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r,a,o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=n(0),c=(a=i)&&a.__esModule?a:{default:a},l=n(31),u=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(n(10)),s=(n(24),n(16));n(2642);n(186);var d=(0,l.connect)(function(e){return e})(r=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.htmlWidth=0,n.renderPdf=function(e){var t=document.getElementById("canvas_wrapper");t.innerHTML="";var r=atob(e),a=window.PDFJS;if(!a)return n.setState({networkFaild:!0}),message.info("网路问题导致PDF预览相关文件加载失败",2);if(a.cMapUrl="https://cdn.jsdelivr.net/npm/pdfjs-dist@2.0.288/cmaps/",a.cMapPacked=!0,!a.getDocument)return n.setState({networkFaild:!0}),message.info("网路问题导致PDF预览相关文件加载失败",2);var o=a.getDocument({data:r}),i=n;o.promise.then(function(e){for(var n="",r=(e.numPages,0);r<e.numPages;r++)(n=document.createElement("canvas")).id="pdf_canvas_"+r,t.appendChild(n);for(var a=function(t){e.getPage(t+1).then(function(e){var n=e.pageInfo.view[2],r=function(){var e=document.getElementById("pdf_canvas_"+t).getContext("2d");return(window.devicePixelRatio||1)/(e.webkitBackingStorePixelRatio||e.mozBackingStorePixelRatio||e.msBackingStorePixelRatio||e.oBackingStorePixelRatio||e.backingStorePixelRatio||1)}(),a=e.getViewport((i.htmlWidth-20)/n),o=document.getElementById("pdf_canvas_"+t);console.log("viewport.width",a.width),o.style.width=a.width+"px",o.style.height=a.height+"px",o.width=a.width*r,o.height=a.height*r;var c=o.getContext("2d");return e.render({transform:[r,0,0,r,0,0],canvasContext:c,viewport:a}).promise})},o=0;o<e.numPages;o++)a(o)}).catch(function(e){document.getElementById("canvas_wrapper").innerHTML="",i.setState({broken:!0}),console.error("PDFPreviewError: "+e)})},n.state={broken:!1,networkFaild:!1},n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,c.default.Component),o(t,[{key:"componentDidMount",value:function(){u.setTitle({title:"PDF预览"}),u.setIcon({showIcon:!1}),u.setRight({show:!1}),this.props.previewEnclosureState.get("base64")&&(this.setState({broken:!1}),this.renderPdf(this.props.previewEnclosureState.get("base64")));var e=document.getElementById("canvas_wrapper");this.htmlWidth=Number(window.getComputedStyle(e).width.replace("px",""))}},{key:"componentWillReceiveProps",value:function(e){console.log("dededfef")}},{key:"render",value:function(){var e=this.props,t=(e.dispatch,e.previewEnclosureState,this.state),n=t.broken,r=t.networkFaild;return c.default.createElement(s.Container,{className:"img-box"},c.default.createElement("div",{className:"img-box-contain"},c.default.createElement("div",{className:"pdf-box-contain-overflow"},c.default.createElement("div",{className:"pdf_canvas_main"},c.default.createElement("div",{className:"pdf_canvas_pdf"},c.default.createElement("div",{id:"canvas_wrapper"}))),n?c.default.createElement("div",{className:"noSupport"},c.default.createElement(s.Icon,{type:"file"}),c.default.createElement("p",null,"PDF文件损坏，无法预览")):"",r?c.default.createElement("div",{className:"noSupport"},c.default.createElement(s.Icon,{type:"file"}),c.default.createElement("p",null,"网络异常，无法预览")):"")))}}]),t}())||r;t.default=d},2642:function(e,t,n){}}]);
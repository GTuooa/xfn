(window.webpackJsonp=window.webpackJsonp||[]).push([[118],{1359:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.INIT_CXPZ="INIT_CXPZ",t.CHANGE_FJGL_ISSUEDATE="CHANGE_FJGL_ISSUEDATE",t.GET_FJGL_DATA="GET_FJGL_DATA",t.SELECT_FJ_VC_ITEM="SELECT_FJ_VC_ITEM",t.SELECT_FJ_ITEM="SELECT_FJ_ITEM",t.GET_DELETE_DATA="GET_DELETE_DATA",t.OPEN_LABEL_MODAL="OPEN_LABEL_MODAL",t.CHANGE_CURRENT_LABEL="CHANGE_CURRENT_LABEL",t.CHANGE_LABEL_VALUE="CHANGE_LABEL_VALUE",t.GET_DOWNLOAD_DATA="GET_DOWNLOAD_DATA",t.CHANGE_ALL_FJ_CHECKBOX_DISPLAY="CHANGE_ALL_FJ_CHECKBOX_DISPLAY",t.CANCEL_CHANGE_FJ_CHECKBOX_DISPALY="CANCEL_CHANGE_FJ_CHECKBOX_DISPALY"},1400:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:c,n=arguments[1];return((e={},o(e,r.INIT_CXPZ,function(){return c}),o(e,r.CHANGE_FJGL_ISSUEDATE,function(){return t.set("issuedate",n.issuedate)}),o(e,r.GET_FJGL_DATA,function(){n.receivedData;var e=[];n.receivedData.labelArray.forEach(function(t,n){e.push({key:t,value:t})});var l=[{key:"全部",value:"全部"}].concat(e);return t=t.update("vclist",function(e){return e.clear().merge((0,a.fromJS)(n.receivedData.jsonArray))}).set("totalSize",n.receivedData.totalSize).set("useSizeByCorp",n.receivedData.useSizeByCorp).set("useSizeBySob",n.receivedData.useSizeBySob).set("label",(0,a.fromJS)(l)).set("fjLabel",(0,a.fromJS)(e))}),o(e,r.SELECT_FJ_VC_ITEM,function(){var e=!t.getIn(["vclist",n.idx,"checkboxDisplay"]),l=t.getIn(["vclist",n.idx]).toJS();return l.checkboxDisplay=e,l.enclosureList.forEach(function(t){t.checkboxFjDisplay=e}),t=t.updateIn(["vclist",n.idx],function(e){return(0,a.fromJS)(l)})}),o(e,r.SELECT_FJ_ITEM,function(){return(t=t.updateIn(["vclist",n.idx,"enclosureList",n.fjIdx,"checkboxFjDisplay"],function(e){return!e})).setIn(["vclist",n.idx,"checkboxDisplay"],t.getIn(["vclist",n.idx,"enclosureList"]).every(function(e){return e.get("checkboxFjDisplay")}))}),o(e,r.GET_DELETE_DATA,function(){var e=[];t.get("vclist").map(function(t){t.get("enclosureList").map(function(t){return e.push(t)})});var n=[];return t.get("vclist").forEach(function(e){e.get("enclosureList").forEach(function(t){1!=t.get("checkboxFjDisplay")||n.push(e.get("vcindex"))})}),t.set("needDeleteUrl",(0,a.fromJS)(e).filter(function(e){return 1==e.get("checkboxFjDisplay")})).set("vcIndexArray",Array.from(new Set(n)))}),o(e,r.OPEN_LABEL_MODAL,function(){return t=t.set("vcIdx",n.idx).set("fjIdx",n.fjIdx)}),o(e,r.CHANGE_CURRENT_LABEL,function(){var e=t.get("vcIdx"),l=t.get("fjIdx");return t=t.setIn(["vclist",e,"enclosureList",l,"label"],n.currentLabel).set("currentLabel",n.currentLabel)}),o(e,r.CHANGE_LABEL_VALUE,function(){return t=t.set("labelValue",n.labelValue)}),o(e,r.GET_DOWNLOAD_DATA,function(){var e=[];t.get("vclist").map(function(t){t.get("enclosureList").map(function(t){return e.push(t)})});var n=[];return(0,a.fromJS)(e).filter(function(e){return 1==e.get("checkboxFjDisplay")}).map(function(e){return n.push({url:e.get("enclosurepath"),fileName:e.get("fileName")})}),t.set("needDownLoad",(0,a.fromJS)(n))}),o(e,r.CHANGE_ALL_FJ_CHECKBOX_DISPLAY,function(){return t.set("toolBarDisplayIndex",2).set("allCheckboxDisplay",!0)}),o(e,r.CANCEL_CHANGE_FJ_CHECKBOX_DISPALY,function(){return t.set("toolBarDisplayIndex",1).update("vclist",function(e){return e.map(function(e){return e.set("selected",!1)})}).set("allCheckboxDisplay",!1)}),e)[n.type]||function(){return t})()};var l,a=n(9),r=((l=a)&&l.__esModule,function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(n(1359)));function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var c=(0,a.fromJS)({allCheckboxDisplay:!1,toolBarDisplayIndex:1,lastvoucherid:"",issuedate:"",currentPage:"1",pageCount:"1",modifyvc:!1,vclist:[],totalSize:1,useSizeBySob:0,useSizeByCorp:0,needDeleteUrl:[],vcIndexArray:[],needDownLoad:[],previewSrc:"",label:[],labelValue:"全部",fjLabel:[],currentLabel:"",vcIdx:"",fjIdx:"",updatePath:""})},1488:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.cancelChangeFjCheckBoxDisplay=t.changeFjCheckBoxDisplay=t.download=t.updateLabel=t.openLabelModal=t.getDownloadData=t.changeLabelValue=t.changeFjglIssudate=t.selectFjItem=t.selectFjVcAll=t.selectFjVcItem=t.deleteFjItemFetch=t.getFjListFetch=void 0;var l,a=n(13),r=s(n(1359)),o=n(24),c=(l=o)&&l.__esModule?l:{default:l},i=s(n(10)),u=s(n(25));function s(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}var f=t.getFjListFetch=function(){return function(e,t){var n=t().fjglState,l=n.get("issuedate");i.toast.loading(u.LOADING_TIP_TEXT,0),(0,c.default)("getFjData","POST",JSON.stringify({year:l?l.substr(0,4):"",month:l?l.substr(5,2):"",label:"全部"===n.get("labelValue")?"":n.get("labelValue")}),function(t){(0,a.showMessage)(t)&&e({type:r.GET_FJGL_DATA,receivedData:t.data}),i.toast.hide()})}};t.deleteFjItemFetch=function(){return function(e,t){e({type:r.GET_DELETE_DATA});var n=t().fjglState,l=n.get("issuedate");i.toast.loading(u.LOADING_TIP_TEXT,0),(0,c.default)("deleteFj","POST",JSON.stringify({year:l.substr(0,4),month:l.substr(5,2),enclosureList:n.get("needDeleteUrl"),vcIndexArray:n.get("vcIndexArray")}),function(t){(0,a.showMessage)(t)&&e(f()),i.toast.hide()})}},t.selectFjVcItem=function(e){return{type:r.SELECT_FJ_VC_ITEM,idx:e}},t.selectFjVcAll=function(){return{type:r.SELECT_FJ_VC_ALL}},t.selectFjItem=function(e,t){return{type:r.SELECT_FJ_ITEM,idx:e,fjIdx:t}},t.changeFjglIssudate=function(e){return{type:r.CHANGE_FJGL_ISSUEDATE,issuedate:e}},t.changeLabelValue=function(e){return{type:r.CHANGE_LABEL_VALUE,labelValue:e}},t.getDownloadData=function(){return{type:r.GET_DOWNLOAD_DATA}},t.openLabelModal=function(e,t){return{type:r.OPEN_LABEL_MODAL,idx:e,fjIdx:t}},t.updateLabel=function(e,t){return function(n){i.toast.loading(u.LOADING_TIP_TEXT,0),(0,c.default)("updateLabel","POST",JSON.stringify({enKey:e,label:t}),function(e){(0,a.showMessage)(e)&&(i.toast.hide(),n({type:r.CHANGE_CURRENT_LABEL,currentLabel:t}))})}},t.download=function(){return function(e,t){var n=t().homeState.getIn(["data","userInfo","emplID"]),l=t().fjglState.get("needDownLoad").toJS(),r=[];r=l.length>9?l.slice(0,9):l,i.toast.loading(u.LOADING_TIP_TEXT,0),(0,c.default)("fjglDown","POST",JSON.stringify({userIdList:[n],enclosureList:r}),function(e){(0,a.showMessage)(e,"show")})}},t.changeFjCheckBoxDisplay=function(){return{type:r.CHANGE_ALL_FJ_CHECKBOX_DISPLAY}},t.cancelChangeFjCheckBoxDisplay=function(){return{type:r.CANCEL_CHANGE_FJ_CHECKBOX_DISPALY}}},1822:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var l,a=function(){function e(e,t){for(var n=0;n<t.length;n++){var l=t[n];l.enumerable=l.enumerable||!1,l.configurable=!0,"value"in l&&(l.writable=!0),Object.defineProperty(e,l.key,l)}}return function(t,n,l){return n&&e(t.prototype,n),l&&e(t,l),t}}(),r=p(n(0)),o=(n(9),n(31)),c=d(n(1488)),i=(d(n(1230)),d(n(10))),u=n(123),s=n(16);n(1823);var f=p(n(1825));function d(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}function p(e){return e&&e.__esModule?e:{default:e}}var E=(0,o.connect)(function(e){return e})(l=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,r.default.Component),a(t,[{key:"componentDidMount",value:function(){i.setTitle({title:"凭证附件"}),i.setRight({show:!1}),i.setIcon({showIcon:!1}),this.props.dispatch(c.getFjListFetch())}},{key:"render",value:function(){var e=this.props,t=e.dispatch,n=e.fjglState,l=e.history,a=e.allState,o=e.homeState.getIn(["permissionInfo","Pz"]).getIn(["edit","permission"]),d=n.get("allCheckboxDisplay"),p=n.get("toolBarDisplayIndex"),E=n.get("vclist"),_=n.get("issuedate"),g=(n.get("currentPage"),n.get("pageCount"),a.get("issues")),y=(a.get("period"),a.getIn(["period","openedyear"]),a.getIn(["period","openedmonth"]),!!E.getIn([0,"closedby"])),h=!1,m=!1;E.forEach(function(e){e.get("enclosureList").some(function(e){return e.get("checkboxFjDisplay")})&&(h=!0)&&e.get("reviewedby")&&(m=!0)});var b=n.get("label").toJS(),v=n.get("fjLabel").toJS(),L=n.get("labelValue"),C=n.get("totalSize"),A=(n.get("useSizeBySob"),n.get("useSizeByCorp")),D=(A/(1024*C)*100).toFixed(2);n.get("needDownLoad").toJS();return r.default.createElement(s.Container,{className:"fjgl"},r.default.createElement(u.TopMonthPicker,{issuedate:_,source:g,callback:function(e){t(c.changeFjglIssudate(e)),t(c.getFjListFetch())},onOk:function(e){t(c.changeFjglIssudate(e.value)),t(c.getFjListFetch())}}),r.default.createElement(s.Row,{className:"fjgl-top"},r.default.createElement(s.SinglePicker,{district:b,value:"",onOk:function(e){t(c.changeLabelValue(e.value)),t(c.getFjListFetch())}},r.default.createElement("div",null,L,r.default.createElement(s.Icon,{type:"triangle",size:"11"}))),r.default.createElement("ul",null,r.default.createElement("li",null,"剩余容量：",((1024*C-A)/1024).toFixed(2),"G",r.default.createElement("span",null,C,"G")),r.default.createElement("li",null,r.default.createElement("div",null,r.default.createElement("div",{style:{width:D+"%"}}))))),r.default.createElement(s.ScrollView,{flex:"1",uniqueKey:"fjgl-scroll",savePosition:!0},E.map(function(e,n){return r.default.createElement(f.default,{allCheckboxDisplay:d,idx:n,key:n,vcitem:e,dispatch:t,fjLabel:v,editPermission:o,vclist:E,history:l})})),r.default.createElement(s.Row,null,r.default.createElement(s.ButtonGroup,{type:"ghost",style:{display:1===p?"":"none"}},r.default.createElement(s.Button,{disabled:!o||0===E.size,onClick:function(){t(c.changeFjCheckBoxDisplay())}},r.default.createElement(s.Icon,{type:"select"}),r.default.createElement("span",null,"选择"))),r.default.createElement(s.ButtonGroup,{type:"ghost",style:{display:2===p?"":"none"}},r.default.createElement(s.Button,{disabled:!0,onClick:function(){t(c.getDownloadData()),i.Confirm({message:"单次下载最多支持九个附件，超过九个后默认选择前九个，附件将以消息的形式发送给您",title:"提示",buttonLabels:["取消","确定"],onSuccess:function(e){1===e.buttonIndex&&t(c.download())},onFail:function(e){}})}},r.default.createElement(s.Icon,{type:"download"}),r.default.createElement("span",null,"下载")),r.default.createElement(s.Button,{onClick:function(){return t(c.cancelChangeFjCheckBoxDisplay())}},r.default.createElement(s.Icon,{type:"cancel"}),r.default.createElement("span",null,"取消")),r.default.createElement(s.Button,{disabled:!o||!h||m||y,onClick:function(){return t(c.deleteFjItemFetch())}},r.default.createElement(s.Icon,{type:"delete"}),r.default.createElement("span",null,"删除")))))}}]),t}())||l;t.default=E},1823:function(e,t,n){},1825:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var l,a,r=function(){function e(e,t){for(var n=0;n<t.length;n++){var l=t[n];l.enumerable=l.enumerable||!1,l.configurable=!0,"value"in l&&(l.writable=!0),Object.defineProperty(e,l.key,l)}}return function(t,n,l){return n&&e(t.prototype,n),l&&e(t,l),t}}(),o=n(0),c=(a=o)&&a.__esModule?a:{default:a},i=(n(9),n(22)),u=_(n(1488)),s=_(n(184)),f=n(186),d=n(16),p=_(n(10)),E=n(13);function _(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}var g=(0,i.immutableRenderDecorator)(l=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,c.default.Component),r(t,[{key:"render",value:function(){var e=this.props,t=e.allCheckboxDisplay,n=e.idx,l=e.vcitem,a=e.dispatch,r=e.fjLabel,o=e.editPermission,i=e.vclist,_=e.history,g=l.get("closedby"),y=l.get("reviewedby"),h=function(e){if("TRUE"===e.get("imageOrFile")){var t=[],n=[];i.forEach(function(e){return e.get("enclosureList").forEach(function(e){"TRUE"===e.get("imageOrFile")&&(t.push(e.get("signedUrl")),n.push(e))})});var l=0;n.forEach(function(t,n){t.get("enclosureKey")!=e.get("enclosureKey")||(l=n)}),p.previewImage({urls:t,current:t[l],onSuccess:function(e){},onFail:function(){}})}else if("application/pdf"===e.get("mimeType")){if(e.get("size")>8192)return p.toast.info("文件过大，暂不支持预览。");var r=e.get("signedUrl");a(f.previewEnclosureActions.getCxpzUploadEnclosure(r,function(){_.push("/previewpdf")}))}else p.Alert("文件格式暂不支持预览")};return c.default.createElement("div",{className:"vc"},c.default.createElement(d.Icon,{style:{display:g?"":"none"},className:"fjgl-shenhe-icon ",color:"#DE4646",type:"the-invosing",size:"50"}),c.default.createElement(d.Icon,{style:{display:g?"none":y?"":"none"},className:"fjgl-shenhe-icon",color:"#ff943e",type:"yishenhe",size:"45"}),c.default.createElement("div",{className:"vc-info",onClick:function(){t?a(u.selectFjVcItem(n)):(sessionStorage.setItem("lrpzHandleMode","modify"),_.push("/lrpz"),sessionStorage.setItem("router-from","cxpz"),a(s.getFjFetch(l)))}},c.default.createElement("span",null,c.default.createElement(d.Checkbox,{style:{paddingRight:"10px",display:t?"inline-block":"none"},checked:l.get("checkboxDisplay")}),c.default.createElement("span",{className:"text-underline"},"记 ",l.get("vcindex")," 号")),c.default.createElement("span",{className:"vc-info-date"},l.get("vcdate").replace(/-/g,"/"))),c.default.createElement("div",{className:"vc-jv-list"},l.get("enclosureList").map(function(e,i){return c.default.createElement("div",{className:"vc-fj",key:i},c.default.createElement(d.Checkbox,{className:"fjCheck",style:{display:t?"inline-block":"none"},checked:e.get("checkboxFjDisplay"),onChange:function(){return a(u.selectFjItem(n,i))}}),c.default.createElement("img",{src:(0,E.showImg)(e.get("imageOrFile"),e.get("fileName")),onClick:function(){return h(e)}}),c.default.createElement("ul",{onClick:function(){return h(e)}},c.default.createElement("li",null,e.get("fileName")),c.default.createElement("li",null,e.get("size")+"kb")),c.default.createElement(d.SinglePicker,{district:r,className:"fj-label",disabled:l.get("reviewedby")||l.get("closedby")||!o,value:"",onOk:function(t){a(u.updateLabel(e.get("enclosureKey"),t.value))}},c.default.createElement("span",{onClick:function(){return a(u.openLabelModal(n,i))}},e.get("label"))))})))}}]),t}())||l;t.default=g},960:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.view=t.reducer=void 0;var l=o(n(1822)),a=o(n(1400)),r=o(n(186));function o(e){return e&&e.__esModule?e:{default:e}}var c={fjglState:a.default,previewEnclosureState:r.default};t.reducer=c,t.view=l.default}}]);